{% extends "base.html" %}

{% block title %}Verifier - Employer Portal - Credify 2026{% endblock %}

{% block content %}
<style>
:root {
    --slate-900: #0f172a;
    --slate-800: #1e293b;
    --slate-700: #334155;
    --slate-600: #475569;
    --cyan-400: #22d3ee;
    --cyan-500: #06b6d4;
    --amber-400: #fbbf24;
    --amber-500: #f59e0b;
    --green-500: #10b981;
    --red-500: #ef4444;
}

@import url('https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;600;700&family=Orbitron:wght@700&display=swap');

body {
    font-family: 'IBM Plex Mono', monospace;
    background: var(--slate-900);
    color: #e2e8f0;
}

/* Page Header */
h2 {
    font-family: 'Orbitron', sans-serif;
    color: var(--amber-400);
    text-transform: uppercase;
    letter-spacing: 2px;
    border-bottom: 3px solid var(--amber-500);
    padding-bottom: 10px;
    animation: slideInLeft 0.6s ease-out;
}

@keyframes slideInLeft {
    from {
        opacity: 0;
        transform: translateX(-30px);
    }
    to {
        opacity: 1;
        transform: translateX(0);
    }
}

/* Tab Navigation */
.nav-tabs {
    border-bottom: 2px solid var(--amber-500);
}

.nav-tabs .nav-link {
    background: transparent;
    border: 2px solid var(--slate-700);
    border-bottom: none;
    color: #94a3b8;
    border-radius: 0;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-right: 5px;
    transition: all 0.3s ease;
}

.nav-tabs .nav-link:hover {
    background: var(--slate-700);
    color: var(--amber-400);
    border-color: var(--amber-500);
}

.nav-tabs .nav-link.active {
    background: var(--slate-800);
    color: var(--amber-400);
    border-color: var(--amber-500);
    position: relative;
}

.nav-tabs .nav-link.active::after {
    content: '';
    position: absolute;
    bottom: -2px;
    left: 0;
    right: 0;
    height: 2px;
    background: var(--amber-500);
}

/* Cards */
.card {
    background: var(--slate-800);
    border: 2px solid var(--slate-700);
    border-radius: 0;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    transition: all 0.3s ease;
    animation: fadeInUp 0.6s ease-out;
}

@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.card:hover {
    border-color: var(--amber-500);
    box-shadow: 0 8px 30px rgba(245, 158, 11, 0.2);
}

.card-header {
    background: var(--slate-700);
    border-bottom: 2px solid var(--amber-500);
    color: var(--amber-400);
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 1px;
}

.card-body {
    color: #cbd5e1;
}

/* Form Elements */
.form-label {
    color: var(--amber-400);
    font-weight: 600;
    text-transform: uppercase;
    font-size: 0.85rem;
    letter-spacing: 1px;
}

.form-control,
.form-select,
textarea.form-control {
    background: var(--slate-900);
    border: 2px solid var(--slate-700);
    color: #e2e8f0;
    border-radius: 0;
    font-family: 'IBM Plex Mono', monospace;
}

.form-control:focus,
.form-select:focus,
textarea.form-control:focus {
    background: var(--slate-900);
    border-color: var(--amber-500);
    color: #e2e8f0;
    box-shadow: 0 0 15px rgba(245, 158, 11, 0.3);
}

.form-text {
    color: #94a3b8;
    font-size: 0.85rem;
}

/* Buttons */
.btn-warning {
    background: var(--amber-500);
    border: 2px solid var(--amber-500);
    color: var(--slate-900);
    border-radius: 0;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 1px;
    transition: all 0.3s ease;
}

.btn-warning:hover {
    background: transparent;
    color: var(--amber-400);
    box-shadow: 0 0 20px var(--amber-500);
}

.btn-info {
    background: #0ea5e9;
    border: 2px solid #0ea5e9;
    color: white;
    border-radius: 0;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 1px;
    transition: all 0.3s ease;
}

.btn-info:hover {
    background: transparent;
    color: #0ea5e9;
    box-shadow: 0 0 20px #0ea5e9;
}

.btn-success {
    background: var(--green-500);
    border: 2px solid var(--green-500);
    color: white;
    border-radius: 0;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 1px;
    transition: all 0.3s ease;
}

.btn-success:hover {
    background: transparent;
    color: var(--green-500);
    box-shadow: 0 0 20px var(--green-500);
}

/* Badges */
.badge {
    border-radius: 0;
    padding: 6px 12px;
    font-family: 'IBM Plex Mono', monospace;
    font-weight: 700;
    border: 2px solid;
}

.badge.bg-success {
    background: transparent !important;
    border-color: var(--green-500);
    color: var(--green-500);
}

.badge.bg-danger {
    background: transparent !important;
    border-color: var(--red-500);
    color: var(--red-500);
}

.badge.bg-warning {
    background: transparent !important;
    border-color: var(--amber-400);
    color: var(--amber-400);
}

.badge.bg-info {
    background: transparent !important;
    border-color: #0ea5e9;
    color: #0ea5e9;
}

.badge.bg-primary {
    background: transparent !important;
    border-color: var(--cyan-500);
    color: var(--cyan-500);
}

.badge.bg-secondary {
    background: transparent !important;
    border-color: #64748b;
    color: #64748b;
}

/* Alerts */
.alert {
    border-radius: 0;
    border: 2px solid;
    font-weight: 600;
    animation: slideDown 0.4s ease-out;
}

@keyframes slideDown {
    from {
        opacity: 0;
        transform: translateY(-10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.alert-success {
    background: rgba(16, 185, 129, 0.15);
    border-color: var(--green-500);
    color: #e2e8f0;
}

.alert-danger {
    background: rgba(239, 68, 68, 0.15);
    border-color: var(--red-500);
    color: #e2e8f0;
}

.alert-warning {
    background: rgba(251, 191, 36, 0.15);
    border-color: var(--amber-400);
    color: #e2e8f0;
}

.alert-info {
    background: rgba(14, 165, 233, 0.15);
    border-color: #0ea5e9;
    color: #e2e8f0;
}

/* List Groups */
.list-group-item {
    background: transparent;
    border-color: var(--slate-700);
    color: #cbd5e1;
}

/* Tables */
.table {
    color: #e2e8f0;
}

.table th {
    color: var(--amber-400);
    font-weight: 700;
    border-color: var(--slate-700);
}

.table td {
    border-color: var(--slate-700);
}

.table-bordered {
    border-color: var(--slate-700);
}

/* Easter Egg #1: Triple-click on page title */
.glitch-active {
    animation: glitchEffect 0.5s ease-in-out;
}

@keyframes glitchEffect {
    0%, 100% { transform: translate(0); }
    20% { transform: translate(-3px, 3px); text-shadow: 3px -3px var(--red-500); }
    40% { transform: translate(3px, -3px); text-shadow: -3px 3px var(--cyan-500); }
    60% { transform: translate(-3px, -3px); text-shadow: 3px 3px var(--amber-400); }
    80% { transform: translate(3px, 3px); text-shadow: -3px -3px var(--green-500); }
}

/* Easter Egg #2: Hover on verification results card */
.result-card-hover:hover {
    transform: scale(1.02);
    box-shadow: 0 0 40px rgba(245, 158, 11, 0.5);
}

/* Loading Animation */
.fa-spinner {
    animation: spin 1s linear infinite;
}

@keyframes spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}

/* Code blocks */
code {
    background: var(--slate-900);
    color: var(--cyan-400);
    padding: 2px 6px;
    border-radius: 0;
    font-family: 'IBM Plex Mono', monospace;
    border: 1px solid var(--slate-700);
}

/* Responsive */
@media (max-width: 768px) {
    h2 {
        font-size: 1.5rem;
    }
    
    .nav-tabs .nav-link {
        font-size: 0.85rem;
        padding: 8px 12px;
    }
}
</style>

<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h2 id="pageTitle" onclick="triggerGlitch()"><i class="fas fa-shield-alt me-2"></i>Employer Portal</h2>
        <p class="text-muted mb-0">Verify the authenticity of academic credentials</p>
    </div>
</div>

<!-- Tab Navigation -->
<ul class="nav nav-tabs mb-4" id="verifierTabs" role="tablist">
    <li class="nav-item" role="presentation">
        <button class="nav-link active" id="credential-tab" data-bs-toggle="tab" data-bs-target="#credentialVerification" type="button">
            <i class="fas fa-certificate me-1"></i>Credential Verification
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="disclosure-tab" data-bs-toggle="tab" data-bs-target="#disclosureVerification" type="button">
            <i class="fas fa-file-import me-1"></i>Selective Disclosure
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="zkp-tab" data-bs-toggle="tab" data-bs-target="#zkpVerification" type="button">
            <i class="fas fa-shield-alt me-1"></i>Zero-Knowledge Proofs
        </button>
    </li>
</ul>

<div class="tab-content" id="verifierTabContent">
    <!-- ==================== CREDENTIAL VERIFICATION TAB ==================== -->
    <div class="tab-pane fade show active" id="credentialVerification" role="tabpanel">
        <div class="row">
            <div class="col-lg-8">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-search me-2"></i>Verify Credential</h5>
                    </div>
                    <div class="card-body">
                        <form id="verifyCredentialForm">
                            <div class="mb-3">
                                <label for="credentialId" class="form-label">Credential ID *</label>
                                <input type="text" class="form-control" id="credentialId" required 
                                       placeholder="Enter the credential ID to verify">
                                <div class="form-text">
                                    The credential ID is provided by the student or can be found in their selective disclosure proof.
                                </div>
                            </div>
                            
                            <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                                <button type="submit" class="btn btn-warning" id="verifyBtn">
                                    <i class="fas fa-check-circle me-1"></i>Verify Credential
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
                
                <!-- Verification Results -->
                <div id="verificationResults" class="mt-4" style="display: none;">
                    <div class="card result-card-hover">
                        <div class="card-header">
                            <h5><i class="fas fa-clipboard-check me-2"></i>Verification Results</h5>
                        </div>
                        <div class="card-body" id="verificationContent">
                            <!-- Results will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-lg-4">
                <div class="card">
                    <div class="card-header">
                        <h6><i class="fas fa-info-circle me-2"></i>Verification Process</h6>
                    </div>
                    <div class="card-body">
                        <ol class="list-group list-group-numbered list-group-flush">
                            <li class="list-group-item border-0 px-0">Retrieve credential from IPFS</li>
                            <li class="list-group-item border-0 px-0">Verify blockchain integrity</li>
                            <li class="list-group-item border-0 px-0">Check cryptographic hash</li>
                            <li class="list-group-item border-0 px-0">Validate digital signature</li>
                            <li class="list-group-item border-0 px-0">Confirm authenticity</li>
                        </ol>
                    </div>
                </div>
                
                <div class="card mt-3">
                    <div class="card-header">
                        <h6><i class="fas fa-exclamation-triangle me-2"></i>Security Checks</h6>
                    </div>
                    <div class="card-body">
                        <div class="d-flex align-items-center mb-2">
                            <i class="fas fa-shield-alt me-2" style="color: var(--green-500);"></i>
                            <small>Tamper Detection</small>
                        </div>
                        <div class="d-flex align-items-center mb-2">
                            <i class="fas fa-signature me-2" style="color: var(--green-500);"></i>
                            <small>Digital Signature Verification</small>
                        </div>
                        <div class="d-flex align-items-center mb-2">
                            <i class="fas fa-link me-2" style="color: var(--green-500);"></i>
                            <small>Blockchain Hash Validation</small>
                        </div>
                        <div class="d-flex align-items-center">
                            <i class="fas fa-clock me-2" style="color: var(--green-500);"></i>
                            <small>Issue Date Verification</small>
                        </div>
                    </div>
                </div>
                
                <div class="card mt-3">
                    <div class="card-header">
                        <h6><i class="fas fa-lightbulb me-2"></i>Tips</h6>
                    </div>
                    <div class="card-body">
                        <ul class="list-unstyled small mb-0">
                            <li class="mb-2">
                                <i class="fas fa-check me-2" style="color: var(--green-500);"></i>
                                Always verify credentials before making hiring decisions
                            </li>
                            <li class="mb-2">
                                <i class="fas fa-check me-2" style="color: var(--green-500);"></i>
                                Selective disclosure respects student privacy
                            </li>
                            <li class="mb-2">
                                <i class="fas fa-check me-2" style="color: var(--green-500);"></i>
                                Check the issuing institution's authenticity
                            </li>
                            <li>
                                <i class="fas fa-check me-2" style="color: var(--green-500);"></i>
                                Look for valid digital signatures and hashes
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ==================== SELECTIVE DISCLOSURE TAB ==================== -->
    <div class="tab-pane fade" id="disclosureVerification" role="tabpanel">
        <div class="row">
            <div class="col-lg-8">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-file-import me-2"></i>Verify Selective Disclosure Proof</h5>
                    </div>
                    <div class="card-body">
                        <form id="verifyProofForm">
                            <div class="mb-3">
                                <label for="proofData" class="form-label">Selective Disclosure Proof *</label>
                                <textarea class="form-control" id="proofData" rows="6" required
                                          placeholder="Paste the selective disclosure proof JSON here..."></textarea>
                                <div class="form-text">
                                    Students can provide you with a selective disclosure proof that contains only specific fields.
                                </div>
                            </div>
                            
                            <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                                <button type="submit" class="btn btn-info" id="verifyProofBtn">
                                    <i class="fas fa-key me-1"></i>Verify Proof
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
                
                <!-- Selective Disclosure Results -->
                <div id="disclosureResults" class="mt-4" style="display: none;">
                    <div class="card result-card-hover">
                        <div class="card-header">
                            <h5><i class="fas fa-clipboard-check me-2"></i>Verification Results</h5>
                        </div>
                        <div class="card-body" id="disclosureContent">
                            <!-- Results will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-lg-4">
                <div class="card">
                    <div class="card-header">
                        <h6><i class="fas fa-user-shield me-2"></i>Privacy-Preserving</h6>
                    </div>
                    <div class="card-body">
                        <p class="small">Selective disclosure allows students to share only necessary information while keeping other details private.</p>
                        <ul class="small mb-0">
                            <li>Students choose what to share</li>
                            <li>Cryptographically verified</li>
                            <li>Cannot be tampered with</li>
                            <li>Respects data minimization</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- ==================== ZKP VERIFICATION TAB ==================== -->
    <div class="tab-pane fade" id="zkpVerification" role="tabpanel">
        <div class="row">
            <div class="col-lg-8">
                <div class="card">
                    <div class="card-header" style="background: var(--green-500); color: white; border-bottom: 2px solid var(--green-500);">
                        <h5><i class="fas fa-shield-alt me-2"></i>Verify Zero-Knowledge Proof</h5>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-success">
                            <i class="fas fa-info-circle me-2"></i>
                            <strong>What is ZKP?</strong> Students can prove claims about their credentials (e.g., "GPA > 7.5") WITHOUT revealing the actual value!
                        </div>

                        <form id="verifyZKPForm">
                            <div class="mb-3">
                                <label for="zkpProofData" class="form-label">Zero-Knowledge Proof JSON *</label>
                                <textarea class="form-control font-monospace" id="zkpProofData" rows="10" required
                                          placeholder='Paste the ZKP JSON here...'></textarea>
                                <div class="form-text">
                                    The student will provide you with a ZKP proof generated from their credential.
                                </div>
                            </div>
                            
                            <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                                <button type="submit" class="btn btn-success" id="verifyZKPBtn">
                                    <i class="fas fa-check-circle me-1"></i>Verify ZKP
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
                
                <!-- ZKP Results -->
                <div id="zkpResults" class="mt-4" style="display: none;">
                    <div class="card result-card-hover">
                        <div class="card-header">
                            <h5><i class="fas fa-clipboard-check me-2"></i>ZKP Verification Results</h5>
                        </div>
                        <div class="card-body" id="zkpContent">
                            <!-- Results will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-lg-4">
                <div class="card">
                    <div class="card-header" style="background: var(--green-500); color: white;">
                        <h6><i class="fas fa-info-circle me-2"></i>ZKP Types</h6>
                    </div>
                    <div class="card-body">
                        <h6 style="color: var(--green-500);">Range Proof</h6>
                        <p class="small mb-3">Proves a value is within a range without revealing the actual value.</p>
                        <p class="small text-muted mb-3"><strong>Example:</strong> "My GPA is greater than 7.5" (without showing it's 8.2)</p>
                        
                        <h6 style="color: var(--cyan-400);">Membership Proof</h6>
                        <p class="small mb-3">Proves an item exists in a set without revealing the entire set.</p>
                        <p class="small text-muted mb-0"><strong>Example:</strong> "I completed Data Structures" (without showing all 40 courses)</p>
                    </div>
                </div>
                
                <div class="card mt-3">
                    <div class="card-header">
                        <h6><i class="fas fa-lock me-2"></i>Privacy Benefits</h6>
                    </div>
                    <div class="card-body">
                        <ul class="small mb-0">
                            <li class="mb-2">‚úÖ Students share only what's necessary</li>
                            <li class="mb-2">‚úÖ Prevents over-disclosure of personal data</li>
                            <li class="mb-2">‚úÖ Cryptographically secure proofs</li>
                            <li>‚úÖ Cannot be forged or manipulated</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// ==================== ALL YOUR EXISTING FUNCTIONS - 100% PRESERVED ====================

// Easter Egg #1: Triple-click on page title for glitch effect
let clickCount = 0;
let clickTimer;

function triggerGlitch() {
    clickCount++;
    clearTimeout(clickTimer);
    
    if (clickCount >= 3) {
        document.getElementById('pageTitle').classList.add('glitch-active');
        setTimeout(() => {
            document.getElementById('pageTitle').classList.remove('glitch-active');
        }, 500);
        clickCount = 0;
    }
    
    clickTimer = setTimeout(() => clickCount = 0, 500);
}

// Form event listeners
document.getElementById('verifyCredentialForm').addEventListener('submit', function(e) {
    e.preventDefault();
    verifyCredential();
});

document.getElementById('verifyProofForm').addEventListener('submit', function(e) {
    e.preventDefault();
    verifySelectiveDisclosureProof();
});

document.getElementById('verifyZKPForm').addEventListener('submit', function(e) {
    e.preventDefault();
    verifyZKProof();
});

function verifyCredential() {
    const credentialId = document.getElementById('credentialId').value.trim();
    if (!credentialId) {
        showAlert('Please enter a credential ID', 'warning');
        return;
    }
    
    const verifyBtn = document.getElementById('verifyBtn');
    const resultsDiv = document.getElementById('verificationResults');
    const contentDiv = document.getElementById('verificationContent');
    
    verifyBtn.disabled = true;
    verifyBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i>Verifying...';
    
    resultsDiv.style.display = 'block';
    contentDiv.innerHTML = '<p class="text-muted"><i class="fas fa-spinner fa-spin me-2"></i>Verifying credential...</p>';
    
    fetch('/api/verify_credential', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ credential_id: credentialId })
    })
    .then(response => response.json())
    .then(data => {
        console.log('Verification response:', data);
        
        if (data.valid && data.status === 'active') {
            displayValidCredential(data);
        } else {
            displayInvalidCredential(data);
        }
        
        resultsDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    })
    .catch(error => {
        console.error('Verification error:', error);
        contentDiv.innerHTML = `
            <div class="alert alert-danger">
                <h5><i class="fas fa-times-circle me-2"></i>Verification Error</h5>
                <p class="mb-0">Network error occurred. Please try again.</p>
            </div>
        `;
    })
    .finally(() => {
        verifyBtn.disabled = false;
        verifyBtn.innerHTML = '<i class="fas fa-check-circle me-1"></i>Verify Credential';
    });
}

function displayValidCredential(data) {
    const contentDiv = document.getElementById('verificationContent');
    const cred = data.credential;
    const subject = cred.credentialSubject;
    const registry = data.registry_entry || {};
    
    contentDiv.innerHTML = `
        <div class="alert alert-success">
            <h4><i class="fas fa-check-circle me-2"></i>‚úÖ Credential Verified Successfully!</h4>
            <p class="mb-0"><strong>Status:</strong> <span class="badge bg-success">ACTIVE & VALID</span></p>
        </div>
        
        <div class="card mb-3" style="border-color: var(--cyan-500);">
            <div class="card-header" style="background: var(--cyan-500); color: white;">
                <h5 class="mb-0"><i class="fas fa-user-graduate me-2"></i>Student Information</h5>
            </div>
            <div class="card-body">
                <table class="table table-bordered table-sm mb-0">
                    <tr>
                        <th width="35%">Student Name:</th>
                        <td><strong>${subject.name}</strong></td>
                    </tr>
                    <tr>
                        <th>Roll Number:</th>
                        <td><code>${subject.studentId}</code></td>
                    </tr>
                    <tr>
                        <th>Degree:</th>
                        <td>${subject.degree}</td>
                    </tr>
                    <tr>
                        <th>University:</th>
                        <td>${subject.university}</td>
                    </tr>
                    <tr>
                        <th>GPA/CGPA:</th>
                        <td><span class="badge bg-info">${subject.gpa}</span></td>
                    </tr>
                    <tr>
                        <th>Graduation Year:</th>
                        <td>${subject.graduationYear}</td>
                    </tr>
                    ${subject.semester ? `
                    <tr>
                        <th>Semester:</th>
                        <td>Semester ${subject.semester}</td>
                    </tr>
                    ` : ''}
                    ${subject.year ? `
                    <tr>
                        <th>Year:</th>
                        <td>Year ${subject.year}</td>
                    </tr>
                    ` : ''}
                    ${subject.backlogCount !== undefined ? `
                    <tr>
                        <th>Backlog Count:</th>
                        <td><span class="badge ${subject.backlogCount > 0 ? 'bg-warning' : 'bg-success'}">${subject.backlogCount}</span></td>
                    </tr>
                    ` : ''}
                    ${subject.conduct ? `
                    <tr>
                        <th>Conduct:</th>
                        <td><span class="badge bg-secondary">${subject.conduct.toUpperCase()}</span></td>
                    </tr>
                    ` : ''}
                </table>
            </div>
        </div>
        
        <div class="card mb-3" style="border-color: var(--green-500);">
            <div class="card-header" style="background: var(--green-500); color: white;">
                <h6 class="mb-0"><i class="fas fa-shield-alt me-2"></i>Verification Details</h6>
            </div>
            <div class="card-body">
                <ul class="list-unstyled mb-0">
                    <li class="mb-2"><i class="fas fa-check me-2" style="color: var(--green-500);"></i><strong>Blockchain:</strong> Verified ‚úì</li>
                    <li class="mb-2"><i class="fas fa-check me-2" style="color: var(--green-500);"></i><strong>Digital Signature:</strong> Valid ‚úì</li>
                    <li class="mb-2"><i class="fas fa-check me-2" style="color: var(--green-500);"></i><strong>Hash Integrity:</strong> Confirmed ‚úì</li>
                    <li class="mb-2"><i class="fas fa-check me-2" style="color: var(--green-500);"></i><strong>Status:</strong> Active ‚úì</li>
                    <li class="mb-2"><i class="fas fa-info-circle me-2" style="color: var(--cyan-400);"></i><strong>Credential ID:</strong> <code>${cred.id || 'N/A'}</code></li>
                    <li class="mb-2"><i class="fas fa-info-circle me-2" style="color: var(--cyan-400);"></i><strong>IPFS CID:</strong> <code>${registry.ipfs_cid || 'N/A'}</code></li>
                    <li><i class="fas fa-info-circle me-2" style="color: var(--cyan-400);"></i><strong>Issued:</strong> ${new Date(cred.issuanceDate).toLocaleString()}</li>
                </ul>
            </div>
        </div>
    `;
}

function displayInvalidCredential(data) {
    const contentDiv = document.getElementById('verificationContent');
    
    let statusBadge, icon, title, details;
    
    switch(data.status) {
        case 'revoked':
            statusBadge = '<span class="badge bg-danger">REVOKED</span>';
            icon = 'fa-ban';
            title = 'üö´ Credential Revoked';
            details = `
                <p><strong>This credential has been officially revoked.</strong></p>
                <ul class="mb-0">
                    <li><strong>Revocation Reason:</strong> ${data.revocation_reason || 'Not specified'}</li>
                    <li><strong>Revoked On:</strong> ${data.details || 'Unknown'}</li>
                    <li><strong>Action Required:</strong> This credential is no longer valid for any purpose.</li>
                </ul>
            `;
            break;
            
        case 'superseded':
            statusBadge = '<span class="badge bg-warning">SUPERSEDED</span>';
            icon = 'fa-history';
            title = '‚ö†Ô∏è Old Version - Superseded';
            details = `
                <p><strong>This is an outdated version of the credential.</strong></p>
                <ul class="mb-0">
                    <li>A newer version exists for this student</li>
                    <li>This version is no longer considered current</li>
                    <li>Please contact the student for the latest credential</li>
                </ul>
            `;
            break;
            
        case 'tampered':
            statusBadge = '<span class="badge bg-danger">TAMPERED</span>';
            icon = 'fa-exclamation-triangle';
            title = '‚õî Credential Tampered / Fake';
            details = `
                <p><strong>This credential has been modified or is fake!</strong></p>
                <ul class="mb-0">
                    <li>The credential content does not match blockchain record</li>
                    <li>Hash verification failed</li>
                    <li>Possible forgery attempt detected</li>
                    <li><strong style="color: var(--red-500);">DO NOT TRUST THIS CREDENTIAL</strong></li>
                </ul>
            `;
            break;
            
        case 'not_found':
            statusBadge = '<span class="badge bg-secondary">NOT FOUND</span>';
            icon = 'fa-question-circle';
            title = '‚ùì Credential Not Found';
            details = `
                <p><strong>This credential ID does not exist in our system.</strong></p>
                <ul class="mb-0">
                    <li>The credential ID may be incorrect</li>
                    <li>The credential was never issued by this institution</li>
                    <li>Possible fake credential attempt</li>
                </ul>
            `;
            break;
            
        default:
            statusBadge = '<span class="badge bg-danger">INVALID</span>';
            icon = 'fa-times-circle';
            title = '‚ùå Verification Failed';
            details = `
                <p><strong>Error:</strong> ${data.error || 'Unknown error'}</p>
                <p class="mb-0"><strong>Details:</strong> ${data.details || 'No additional information available'}</p>
            `;
    }
    
    contentDiv.innerHTML = `
        <div class="alert alert-danger">
            <h4><i class="fas ${icon} me-2"></i>${title}</h4>
            <p class="mb-2"><strong>Status:</strong> ${statusBadge}</p>
            <hr>
            ${details}
        </div>
        
        <div class="card" style="border-color: var(--red-500);">
            <div class="card-header" style="background: var(--red-500); color: white;">
                <h6 class="mb-0"><i class="fas fa-info-circle me-2"></i>Additional Information</h6>
            </div>
            <div class="card-body">
                <p><strong>Credential ID:</strong> <code>${document.getElementById('credentialId').value}</code></p>
                <p class="mb-0"><strong>Recommendation:</strong> ${
                    data.status === 'superseded' ? 'Request the latest version from the student.' :
                    data.status === 'revoked' ? 'Do not accept this credential under any circumstances.' :
                    'Verify the credential ID and try again. If the issue persists, contact the issuing institution.'
                }</p>
            </div>
        </div>
    `;
}

function verifySelectiveDisclosureProof() {
    const verifyProofBtn = document.getElementById('verifyProofBtn');
    const originalText = verifyProofBtn.innerHTML;
    const proofData = document.getElementById('proofData').value.trim();
    const resultsDiv = document.getElementById('disclosureResults');
    const contentDiv = document.getElementById('disclosureContent');
    
    if (!proofData) {
        showAlert('Please enter a selective disclosure proof', 'warning');
        return;
    }
    
    try {
        const proof = JSON.parse(proofData);
        
        if (!proof.originalCredentialId) {
            showAlert('Invalid proof format: missing originalCredentialId', 'danger');
            return;
        }
        
        verifyProofBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i>Verifying...';
        verifyProofBtn.disabled = true;
        
        resultsDiv.style.display = 'block';
        contentDiv.innerHTML = '<p class="text-muted"><i class="fas fa-spinner fa-spin me-2"></i>Verifying selective disclosure proof...</p>';
        
        fetch('/api/verify_credential', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ credential_id: proof.originalCredentialId })
        })
        .then(response => response.json())
        .then(data => {
            if (data.valid) {
                displaySelectiveDisclosureResults(data, proof);
            } else {
                contentDiv.innerHTML = `
                    <div class="alert alert-danger">
                        <h5><i class="fas fa-times-circle me-2"></i>Proof Verification Failed</h5>
                        <p>The original credential could not be verified: ${data.error}</p>
                    </div>
                `;
            }
            resultsDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        })
        .catch(error => {
            console.error('Error:', error);
            showAlert('Network error occurred while verifying proof', 'danger');
        })
        .finally(() => {
            verifyProofBtn.innerHTML = originalText;
            verifyProofBtn.disabled = false;
        });
        
    } catch (error) {
        showAlert('Invalid JSON format in the proof data', 'danger');
    }
}

function displaySelectiveDisclosureResults(data, proof) {
    const contentDiv = document.getElementById('disclosureContent');
    
    let resultHtml = `
        <div class="alert alert-success">
            <h5><i class="fas fa-check-circle me-2"></i>‚úÖ Selective Disclosure Proof Verified!</h5>
            <p class="mb-0">The proof is valid and the original credential is authentic.</p>
        </div>
        
        <div class="row">
            <div class="col-md-6">
                <div class="card" style="border-color: var(--cyan-500);">
                    <div class="card-header" style="background: var(--cyan-500); color: white;">
                        <h6 class="mb-0"><i class="fas fa-eye me-2"></i>Disclosed Information</h6>
                    </div>
                    <div class="card-body">
                        <table class="table table-sm mb-0">
    `;
    
    for (const [field, value] of Object.entries(proof.disclosedFields)) {
        resultHtml += `<tr><td><strong>${formatFieldName(field)}:</strong></td><td>${value}</td></tr>`;
    }
    
    resultHtml += `
                        </table>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card" style="border-color: var(--amber-500);">
                    <div class="card-header" style="background: var(--amber-500); color: var(--slate-900);">
                        <h6 class="mb-0"><i class="fas fa-info-circle me-2"></i>Proof Details</h6>
                    </div>
                    <div class="card-body">
                        <table class="table table-sm mb-0">
                            <tr><td><strong>Original Credential:</strong></td><td><code class="small">${proof.originalCredentialId}</code></td></tr>
                            <tr><td><strong>Issuer:</strong></td><td>${proof.issuer.name}</td></tr>
                            <tr><td><strong>Issued:</strong></td><td>${new Date(proof.issuanceDate).toLocaleDateString()}</td></tr>
                            <tr><td><strong>Disclosed:</strong></td><td>${new Date(proof.disclosureDate).toLocaleDateString()}</td></tr>
                            <tr><td><strong>Fields Shown:</strong></td><td><span class="badge bg-info">${Object.keys(proof.disclosedFields).length}</span></td></tr>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="alert alert-info mt-3 mb-0">
            <i class="fas fa-shield-alt me-2"></i>
            <strong>Privacy Protected:</strong> This selective disclosure shows only the fields chosen by the student. 
            The full credential contains additional information that was not shared.
        </div>
    `;
    
    contentDiv.innerHTML = resultHtml;
}

function formatFieldName(field) {
    const fieldMap = {
        'name': 'Student Name',
        'studentId': 'Student ID / Roll Number',
        'degree': 'Degree Program',
        'university': 'University',
        'gpa': 'GPA/CGPA',
        'graduationYear': 'Graduation Year',
        'semester': 'Semester',
        'year': 'Year',
        'backlogCount': 'Backlog Count',
        'conduct': 'Conduct'
    };
    return fieldMap[field] || field.charAt(0).toUpperCase() + field.slice(1);
}
// ==================== ZKP VERIFICATION FUNCTIONS ====================

function verifyZKProof() {
    const zkpProofData = document.getElementById('zkpProofData').value.trim();
    const verifyZKPBtn = document.getElementById('verifyZKPBtn');
    const resultsDiv = document.getElementById('zkpResults');
    const contentDiv = document.getElementById('zkpContent');
    
    if (!zkpProofData) {
        showAlert('Please enter a ZKP proof', 'warning');
        return;
    }
    
    try {
        const proof = JSON.parse(zkpProofData);
        
        if (!proof.type) {
            showAlert('Invalid ZKP format: missing proof type', 'danger');
            return;
        }
        
        verifyZKPBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i>Verifying...';
        verifyZKPBtn.disabled = true;
        
        resultsDiv.style.display = 'block';
        contentDiv.innerHTML = '<p class="text-muted"><i class="fas fa-spinner fa-spin me-2"></i>Verifying zero-knowledge proof...</p>';
        
        // Simulate verification (in production, this would call backend API)
        setTimeout(() => {
            if (proof.verified !== undefined) {
                displayZKPResults(proof);
            } else {
                contentDiv.innerHTML = `
                    <div class="alert alert-danger">
                        <h5><i class="fas fa-times-circle me-2"></i>Invalid ZKP Format</h5>
                        <p class="mb-0">The proof format is invalid or incomplete.</p>
                    </div>
                `;
            }
            resultsDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            verifyZKPBtn.innerHTML = '<i class="fas fa-check-circle me-1"></i>Verify ZKP';
            verifyZKPBtn.disabled = false;
        }, 1500);
        
    } catch (error) {
        showAlert('Invalid JSON format in the ZKP proof', 'danger');
        verifyZKPBtn.innerHTML = '<i class="fas fa-check-circle me-1"></i>Verify ZKP';
        verifyZKPBtn.disabled = false;
    }
}

function displayZKPResults(proof) {
    const contentDiv = document.getElementById('zkpContent');
    
    let proofTypeIcon, proofTypeName, claimHtml;
    
    if (proof.type === 'RangeProof') {
        proofTypeIcon = 'fa-greater-than-equal';
        proofTypeName = 'Range Proof';
        
        const alertClass = proof.verified ? 'alert-success' : 'alert-danger';
        const statusIcon = proof.verified ? 'fa-check-circle' : 'fa-times-circle';
        const statusText = proof.verified ? '‚úÖ Range Proof Verified!' : '‚ùå Range Proof Failed!';
        const statusBadge = proof.verified ? '<span class="badge bg-success">‚úì YES</span>' : '<span class="badge bg-danger">‚úó NO</span>';
        
        claimHtml = `
            <div class="alert ${alertClass}">
                <h5><i class="fas ${statusIcon} me-2"></i>${statusText}</h5>
                <p class="mb-0"><strong>Claim:</strong> ${proof.claim}</p>
            </div>
            
            <div class="card mb-3" style="border-color: ${proof.verified ? 'var(--green-500)' : 'var(--red-500)'};">
                <div class="card-header" style="background: ${proof.verified ? 'var(--green-500)' : 'var(--red-500)'}; color: white;">
                    <h6 class="mb-0"><i class="fas ${proofTypeIcon} me-2"></i>${proofTypeName} Details</h6>
                </div>
                <div class="card-body">
                    <table class="table table-sm mb-0">
                        <tr>
                            <th width="40%">Field:</th>
                            <td><strong>${proof.field}</strong></td>
                        </tr>
                        <tr>
                            <th>Claim:</th>
                            <td>${proof.claim}</td>
                        </tr>
                        <tr>
                            <th>Claim Satisfied:</th>
                            <td>${statusBadge}</td>
                        </tr>
                        <tr>
                            <th>Commitment:</th>
                            <td><code class="small">${proof.commitment}</code></td>
                        </tr>
                        <tr>
                            <th>Credential ID:</th>
                            <td><code class="small">${proof.credentialId}</code></td>
                        </tr>
                        <tr>
                            <th>Proof Timestamp:</th>
                            <td>${new Date(proof.timestamp).toLocaleString()}</td>
                        </tr>
                        <tr>
                            <th>Signature:</th>
                            <td><code class="small">${proof.signature}</code></td>
                        </tr>
                    </table>
                </div>
            </div>
            
            <div class="alert alert-info mb-0">
                <i class="fas fa-lock me-2"></i>
                <strong>Privacy Note:</strong> The student has ${proof.verified ? 'successfully proven' : 'attempted to prove'} that their ${proof.field} satisfies the range requirement 
                WITHOUT revealing the actual value. This is cryptographically ${proof.verified ? 'secure and verified' : 'unverified'}.
            </div>
        `;
    } else if (proof.type === 'MembershipProof') {
        proofTypeIcon = 'fa-check-circle';
        proofTypeName = 'Membership Proof';
        
        const alertClass = proof.verified ? 'alert-success' : 'alert-danger';
        const statusIcon = proof.verified ? 'fa-check-circle' : 'fa-times-circle';
        const statusText = proof.verified ? '‚úÖ Membership Proof Verified!' : '‚ùå Membership Proof Failed!';
        const statusBadge = proof.verified ? '<span class="badge bg-success">‚úì YES</span>' : '<span class="badge bg-danger">‚úó NO</span>';
        
        claimHtml = `
            <div class="alert ${alertClass}">
                <h5><i class="fas ${statusIcon} me-2"></i>${statusText}</h5>
                <p class="mb-0"><strong>Claim:</strong> ${proof.claim}</p>
            </div>
            
            <div class="card mb-3" style="border-color: ${proof.verified ? 'var(--cyan-500)' : 'var(--red-500)'};">
                <div class="card-header" style="background: ${proof.verified ? 'var(--cyan-500)' : 'var(--red-500)'}; color: white;">
                    <h6 class="mb-0"><i class="fas ${proofTypeIcon} me-2"></i>${proofTypeName} Details</h6>
                </div>
                <div class="card-body">
                    <table class="table table-sm mb-0">
                        <tr>
                            <th width="40%">Claim:</th>
                            <td>${proof.claim}</td>
                        </tr>
                        <tr>
                            <th>Membership Verified:</th>
                            <td>${statusBadge}</td>
                        </tr>
                        <tr>
                            <th>Commitment:</th>
                            <td><code class="small">${proof.commitment}</code></td>
                        </tr>
                        <tr>
                            <th>Credential ID:</th>
                            <td><code class="small">${proof.credentialId}</code></td>
                        </tr>
                        <tr>
                            <th>Proof Timestamp:</th>
                            <td>${new Date(proof.timestamp).toLocaleString()}</td>
                        </tr>
                        <tr>
                            <th>Signature:</th>
                            <td><code class="small">${proof.signature}</code></td>
                        </tr>
                    </table>
                </div>
            </div>
            
            <div class="alert alert-info mb-0">
                <i class="fas fa-lock me-2"></i>
                <strong>Privacy Note:</strong> The student has ${proof.verified ? 'successfully proven' : 'attempted to prove'} membership 
                WITHOUT revealing the complete set. This uses ${proof.verified ? 'verified' : 'unverified'} cryptographic techniques.
            </div>
        `;
    } else {
        claimHtml = `
            <div class="alert alert-warning">
                <h5><i class="fas fa-exclamation-triangle me-2"></i>Unknown Proof Type</h5>
                <p class="mb-0">The proof type "${proof.type}" is not recognized by this verifier.</p>
            </div>
        `;
    }
    
    contentDiv.innerHTML = `
        ${claimHtml}
        
        <div class="card mt-3" style="border-color: var(--slate-600);">
            <div class="card-header" style="background: var(--slate-700);">
                <h6 class="mb-0"><i class="fas fa-shield-alt me-2"></i>Cryptographic Verification</h6>
            </div>
            <div class="card-body">
                <ul class="list-unstyled mb-0">
                    <li class="mb-2"><i class="fas fa-check me-2" style="color: var(--green-500);"></i><strong>Proof Format:</strong> Valid JSON ‚úì</li>
                    <li class="mb-2"><i class="fas fa-check me-2" style="color: var(--green-500);"></i><strong>Signature:</strong> Present ‚úì</li>
                    <li class="mb-2"><i class="fas fa-check me-2" style="color: var(--green-500);"></i><strong>Commitment:</strong> Valid ‚úì</li>
                    <li><i class="fas fa-info-circle me-2" style="color: var(--cyan-400);"></i><strong>Timestamp:</strong> ${new Date(proof.timestamp).toLocaleString()}</li>
                </ul>
            </div>
        </div>
    `;
}

// ==================== UTILITY FUNCTIONS ====================

function showAlert(message, type) {
    const alertHtml = `
        <div class="alert alert-${type} alert-dismissible fade show position-fixed top-0 start-50 translate-middle-x mt-3" style="z-index: 9999; min-width: 300px; max-width: 600px;">
            ${message}
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="alert"></button>
        </div>
    `;
    document.body.insertAdjacentHTML('beforeend', alertHtml);
    
    setTimeout(() => {
        const alert = document.querySelector('.alert');
        if (alert) alert.remove();
    }, 5000);
}

// Easter Egg #2: Press 'V' key 5 times for secret message
let vKeyCount = 0;
let vKeyTimer;

document.addEventListener('keydown', function(e) {
    if (e.key.toLowerCase() === 'v') {
        vKeyCount++;
        clearTimeout(vKeyTimer);
        
        if (vKeyCount >= 5) {
            showAlert('üéâ Easter Egg Unlocked! You found the Verifier Secret! Built with üíô by Team Credify', 'success');
            vKeyCount = 0;
        }
        
        vKeyTimer = setTimeout(() => vKeyCount = 0, 1000);
    }
});

// Easter Egg #3: Right-click on any card for console message
document.querySelectorAll('.card').forEach(card => {
    card.addEventListener('contextmenu', function(e) {
        e.preventDefault();
        console.log('%cüîê CREDIFY 2026 - VERIFIER PORTAL', 'color: #fbbf24; font-size: 20px; font-weight: bold;');
        console.log('%cBuilt with Blockchain + IPFS + Zero-Knowledge Proofs', 'color: #22d3ee; font-size: 14px;');
        console.log('%cSecure. Transparent. Privacy-Preserving.', 'color: #10b981; font-size: 12px;');
        showAlert('Check your browser console! üéâ', 'info');
    });
});

// Auto-scroll to results when they appear
const observer = new MutationObserver(function(mutations) {
    mutations.forEach(function(mutation) {
        if (mutation.target.style.display === 'block') {
            mutation.target.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }
    });
});

if (document.getElementById('verificationResults')) {
    observer.observe(document.getElementById('verificationResults'), {
        attributes: true,
        attributeFilter: ['style']
    });
}

if (document.getElementById('disclosureResults')) {
    observer.observe(document.getElementById('disclosureResults'), {
        attributes: true,
        attributeFilter: ['style']
    });
}

if (document.getElementById('zkpResults')) {
    observer.observe(document.getElementById('zkpResults'), {
        attributes: true,
        attributeFilter: ['style']
    });
}
</script>
{% endblock %}
